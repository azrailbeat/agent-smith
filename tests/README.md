# Тесты для системы Agent Smith

Этот каталог содержит набор автоматических тестов для проверки функциональности системы Agent Smith и связей между её компонентами.

## Структура тестов

Тесты разделены на следующие группы:

1. **API тесты** (`api.test.ts`) - базовая проверка доступности и корректности API.
2. **Тесты обработки обращений граждан** (`citizen-request-process.test.ts`) - проверка полного цикла обработки обращений.
3. **Тесты интеграции блокчейн и активности** (`blockchain-activity-integration.test.ts`) - проверка взаимодействия между блокчейн и системой логирования.
4. **Тесты организационной структуры** (`organizational-structure.test.ts`) - проверка управления отделами, должностями и сотрудниками.
5. **Тесты автоматической обработки и отчетов** (`auto-process-report.test.ts`) - проверка автоматической обработки и генерации отчетов.
6. **Тесты интеграции сервиса агентов** (`agent-service-integration.test.ts`) - проверка работы AI агентов.
7. **Тесты аудита и истории активности** (`activity-history-audit.test.ts`) - проверка системы аудита и истории активности.

## Запуск тестов

### Запуск всех тестов

Для запуска всех тестов выполните:

```bash
./run-tests.sh
```

### Запуск отдельного теста

```bash
npx jest tests/api.test.ts --verbose
```

### Запуск конкретного набора тестов

```bash
npx jest tests/citizen-request-process.test.ts --verbose
```

## Что проверяют тесты

### API тесты
- Доступность основных API endpoints
- Корректность возвращаемых данных
- Структура ответов API

### Тесты обработки обращений граждан
- Создание обращений
- Обработка обращений агентами
- Обновление статусов обращений
- Связи между обращениями и результатами работы агентов

### Тесты интеграции блокчейн и активности
- Запись данных в блокчейн
- Создание записей активности при записи в блокчейн
- Связь между записями блокчейн и активностями

### Тесты организационной структуры
- Управление отделами
- Управление должностями
- Управление сотрудниками
- Связи между отделами, должностями и сотрудниками
- Назначение обращений сотрудникам

### Тесты автоматической обработки и отчетов
- Пакетная обработка обращений
- Генерация отчетов о процессе обработки
- Повторная обработка обращений
- Структура отчетов и статистика

### Тесты интеграции сервиса агентов
- Работа различных типов агентов
- Выполнение различных действий агентами
- Конфигурация агентов
- Сохранение результатов работы агентов

### Тесты аудита и истории активности
- Логирование действий в системе
- Полный аудит жизненного цикла обращений
- Связь между активностями и другими сущностями
- Восстановление истории изменений

## Интерпретация результатов

После запуска тестов вы увидите детальную информацию о пройденных и непройденных тестах. Для каждого теста выводится информация о том, что проверялось и какой результат получен.

### Успешное прохождение тестов

Если все тесты пройдены успешно, в конце вывода вы увидите сообщение "ВСЕ ТЕСТЫ УСПЕШНО ПРОЙДЕНЫ!".

### Неуспешное прохождение тестов

В случае если какие-то тесты не пройдены, вы увидите сообщение "ВНИМАНИЕ: НЕКОТОРЫЕ ТЕСТЫ НЕ ПРОЙДЕНЫ!" с указанием количества непройденных тестов.

## Решение проблем

Если некоторые тесты не проходят, проверьте следующие моменты:

1. **Пропущенные API endpoints** - убедитесь, что все необходимые endpoints API реализованы.
2. **Структура данных** - проверьте соответствие структуры данных ожидаемой в тестах.
3. **Связи между сущностями** - проверьте, что связи между сущностями (обращения, агенты, результаты, активности) сохраняются корректно.
4. **Доступность API ключей** - для тестов, использующих внешние сервисы (AI, блокчейн), убедитесь, что соответствующие API ключи настроены.
5. **База данных** - проверьте, что база данных доступна и содержит необходимые таблицы.

## Расширение тестов

Для добавления новых тестов:

1. Создайте новый файл `tests/your-test-name.test.ts`
2. Добавьте описание тестов с использованием Jest API
3. Обновите скрипт `run-tests.sh`, добавив новый тест в массив тестов